import {
    ColumnType,
    Generated,
    Insertable,
    Selectable,
    Updateable,
} from 'kysely';

/* 
  From docs:
  For production apps, it is recommended to automatically generate your Database interface by introspecting your production database or Prisma schemas. Generated types might differ in naming convention, internal order, etc. Find out more at "Generating types".
  */
export interface Database {
    person: PersonTable;
    friendship: FriendshipTable;
    user: UserTable;
    role: RoleTable;
    role_user: RoleUserTable;
}

export interface PersonTable {
    // Columns that are generated by the database should be marked
    // using the `Generated` type. This way they are automatically
    // made optional in inserts and updates.
    id: Generated<number>;

    first_name: string;
    gender: 'man' | 'woman' | 'other';
    // optional field.
    last_name: string | null;

    created_at: ColumnType<Date, string | undefined, never>;
    updated_at: ColumnType<Date, string | undefined, string | undefined>;
}

// use wrappers to set types
export type Person = Selectable<PersonTable>;
export type NewPerson = Insertable<PersonTable>;
export type PersonUpdate = Updateable<PersonTable>;

export interface FriendshipTable {
    person_1_id: number;
    person_2_id: number;

    last_seen_at: ColumnType<Date, string | undefined, string | undefined>;
    last_contacted_at: ColumnType<Date, string | undefined, string | undefined>;
    created_at: ColumnType<Date, string | undefined, never>;
    updated_at: ColumnType<Date, string | undefined, string | undefined>;
}

export type Friendship = Selectable<FriendshipTable>;
export type NewFriendship = Insertable<FriendshipTable>;
export type FriendshipUpdate = Updateable<FriendshipTable>;

export interface UserTable {
    id: Generated<number>;
    username: string;
    password: string;
    person_id: number;

    created_at: ColumnType<Date, string | undefined, never>;
    updated_at: ColumnType<Date, string | undefined, string | undefined>;
}

export type User = Selectable<UserTable>;
export type NewUser = Insertable<UserTable>;
export type UserUpdate = Updateable<UserTable>;

export interface RoleTable {
    id: Generated<number>;
    role_name: string;

    created_at: ColumnType<Date, string | undefined, never>;
    updated_at: ColumnType<Date, string | undefined, string | undefined>;
}

export type Role = Selectable<RoleTable>;
export type NewRole = Insertable<RoleTable>;
export type RoleUpdate = Updateable<RoleTable>;

export interface RoleUserTable {
    role_id: number;
    user_id: number;

    created_at: ColumnType<Date, string | undefined, never>;
    updated_at: ColumnType<Date, string | undefined, string | undefined>;
}

export type RoleUser = Selectable<RoleUserTable>;
export type NewRoleUser = Insertable<RoleUserTable>;
export type RoleUserUpdate = Updateable<RoleUserTable>;
